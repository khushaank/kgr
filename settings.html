<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Settings - KGR Archive</title>
    <link rel="icon" type="image/png" href="images/KGR.png" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Mono&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body class="settings-view">
    <div id="header-hook"></div>

    <div class="mobile-settings-back" id="mobile-back-btn">
      <span class="material-icons">arrow_back</span>
      <span style="font-weight: 500">Back to Settings</span>
    </div>

    <div class="settings-layout">
      <aside class="settings-sidebar">
        <div class="sidebar-title">Settings</div>
        <nav class="sidebar-nav">
          <div class="nav-item active" data-section="account-section">
            <span class="material-icons">person</span>Account
          </div>
          <div class="nav-item" data-section="notifications-section">
            <span class="material-icons">notifications</span>Notifications
          </div>

          <div class="nav-item" data-section="display-section">
            <span class="material-icons">palette</span>Display
          </div>
          <div class="nav-item" data-section="advanced-section">
            <span class="material-icons">settings</span>Advanced
          </div>
        </nav>
      </aside>

      <main class="settings-main">
        <section id="account-section" class="settings-content">
          <header class="section-header">
            <h1>Account</h1>
            <p class="subtitle">Choose how you appear in the KGR Archive</p>
          </header>
          <div class="channel-info-card">
            <div class="profile-row">
              <div
                class="avatar-container"
                onclick="document.getElementById('avatar-input').click()"
              >
                <img
                  id="avatar-preview"
                  src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzMzMyIgZD0iTTEyIDEyYzIuMjEgMCA0LTEuNzkgNC00cy0xLjc5LTQtNC00LTQgMS43OS00IDQgMS43OSA0IDQgNHptMCAyYy0yLjY3IDAtOCAxLjM0LTggNHYyaDE2di0yYzAtMi42Ni01LjMzLTQtOC00eiIvPjwvc3ZnPg=="
                  alt="Profile"
                />
                <div class="avatar-edit-overlay">
                  <span class="material-icons" style="color: white"
                    >camera_alt</span
                  >
                </div>
                <input
                  type="file"
                  id="avatar-input"
                  style="display: none"
                  accept="image/*"
                />
              </div>
              <div style="flex: 1; width: 100%">
                <form id="settings-form">
                  <div class="input-group">
                    <label>Researcher Name</label>
                    <input
                      type="text"
                      id="set-fullname"
                      required
                      class="studio-input"
                      placeholder="Loading..."
                    />
                  </div>
                  <div class="input-group">
                    <label>Database Username</label>
                    <div class="username-wrapper">
                      <span style="color: #888">@</span>
                      <input
                        type="text"
                        id="set-username"
                        required
                        placeholder="username"
                      />
                      <div id="username-status" class="status-icon"></div>
                    </div>
                    <small id="username-msg"></small>
                  </div>
                  <button type="submit" id="save-settings" class="primary-btn">
                    Authorize Changes
                  </button>
                </form>
              </div>
            </div>
            <div class="settings-section">
              <h4>Connected Accounts</h4>
              <div class="account-link-item">
                <div style="display: flex; align-items: center; gap: 15px">
                  <svg width="24" height="24" viewBox="0 0 24 24">
                    <path
                      d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                      fill="#4285F4"
                    />
                    <path
                      d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                      fill="#34A853"
                    />
                    <path
                      d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                      fill="#FBBC05"
                    />
                    <path
                      d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                      fill="#EA4335"
                    />
                  </svg>
                  <div>
                    <span style="font-weight: 500; display: block"
                      >Google Account</span
                    ><span id="google-link-status">Checking...</span>
                  </div>
                </div>
                <button
                  id="google-unlink-btn"
                  class="secondary-btn"
                  style="display: none"
                >
                  Unlink
                </button>
              </div>
            </div>
            <div class="settings-section">
              <h4>Security Settings</h4>
              <div class="input-group">
                <label for="new-password">New Password (optional)</label>
                <div class="password-input-container">
                  <input
                    type="password"
                    id="new-password"
                    placeholder="••••••••"
                    class="studio-input"
                  />
                  <span
                    class="toggle-password"
                    onclick="togglePassword('new-password')"
                  >
                    <span class="material-icons">visibility</span>
                  </span>
                </div>
                <div class="password-strength-meter" id="password-strength">
                  <div class="strength-bar"></div>
                  <span class="strength-text">Enter a password</span>
                </div>
              </div>
              <button id="change-password-btn" class="primary-btn">
                Update Password
              </button>
            </div>
            <div class="settings-section">
              <h4>Two-Factor Authentication</h4>
              <button
                id="enable-2fa-btn"
                class="primary-btn"
                style="display: none"
              >
                Enable 2FA
              </button>
              <button
                id="disable-2fa-btn"
                class="secondary-btn"
                style="display: none"
              >
                Disable 2FA
              </button>
              <div id="2fa-qr" style="display: none">
                <p style="font-weight: 600; margin-bottom: 10px">
                  Scan with Authenticator App
                </p>
                <img
                  id="qr-code"
                  src="data:image/png;base64,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"
                  alt="QR Code"
                  style="
                    border: 1px solid var(--card-border);
                    width: 180px;
                    display: block;
                    background: white;
                    padding: 10px;
                    margin: 0 auto 20px;
                  "
                />
                <input
                  type="text"
                  id="2fa-code"
                  placeholder="000 000"
                  maxlength="6"
                />
                <button
                  id="verify-2fa-btn"
                  class="primary-btn"
                  style="width: 100%"
                >
                  Verify & Enable
                </button>
              </div>
            </div>
          </div>
        </section>

        <section
          id="notifications-section"
          class="settings-content"
          style="display: none"
        >
          <header class="section-header">
            <h1>Notifications</h1>
            <p class="subtitle">Manage laboratory and publication alerts.</p>
          </header>
          <div class="channel-info-card">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
              "
            >
              <div>
                <h4>Research Publication</h4>
                <p style="font-size: 0.9rem">
                  Notify me when a followed researcher publishes findings.
                </p>
              </div>
              <input
                type="checkbox"
                checked
                style="width: 20px; height: 20px"
              />
            </div>
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-top: 20px;
                border-top: 1px solid #333;
              "
            >
              <div>
                <h4>Security Alerts</h4>
                <p style="font-size: 0.9rem">
                  Receive emails for login attempts or 2FA changes.
                </p>
              </div>
              <input
                type="checkbox"
                checked
                disabled
                style="width: 20px; height: 20px"
              />
            </div>
            <button class="primary-btn" style="width: 100%; margin-top: 20px">
              Authorize Preferences
            </button>
          </div>
        </section>

        <section
          id="display-section"
          class="settings-content"
          style="display: none"
        >
          <header class="section-header">
            <h1>Display & Appearance</h1>
            <p class="subtitle">Customize your KGR Archive experience</p>
          </header>
          <div class="channel-info-card">
            <h4>Application Theme</h4>
            <p
              style="margin-bottom: 20px; font-size: 0.9rem; color: var(--meta)"
            >
              Choose a visual theme for the laboratory terminal.
            </p>

            <div
              class="theme-grid"
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 16px;
              "
            >
              <div
                class="theme-option active"
                onclick="setTheme('default')"
                id="theme-default"
                style="
                  cursor: pointer;
                  padding: 20px;
                  border: 1px solid var(--accent);
                  border-radius: 12px;
                  background: var(--card-bg);
                  text-align: center;
                "
              >
                <div
                  style="
                    width: 48px;
                    height: 48px;
                    background: #0f0f0f;
                    border-radius: 50%;
                    margin: 0 auto 12px;
                    border: 1px solid var(--card-border);
                  "
                ></div>
                <span style="font-weight: 600">Deep Space</span>
              </div>
              <div
                class="theme-option"
                onclick="setTheme('grey-scale')"
                id="theme-grey-scale"
                style="
                  cursor: pointer;
                  padding: 20px;
                  border: 1px solid var(--card-border);
                  border-radius: 12px;
                  background: var(--card-bg);
                  text-align: center;
                "
              >
                <div
                  style="
                    width: 48px;
                    height: 48px;
                    background: #333;
                    border-radius: 50%;
                    margin: 0 auto 12px;
                    border: 1px solid var(--meta);
                  "
                ></div>
                <span style="font-weight: 600">Lab Grey</span>
              </div>
              <div
                class="theme-option"
                onclick="setTheme('white')"
                id="theme-white"
                style="
                  cursor: pointer;
                  padding: 20px;
                  border: 1px solid var(--card-border);
                  border-radius: 12px;
                  background: var(--card-bg);
                  color: var(--text);
                  text-align: center;
                  box-shadow: var(--shadow);
                "
              >
                <div
                  style="
                    width: 48px;
                    height: 48px;
                    background: #fff;
                    border-radius: 50%;
                    margin: 0 auto 12px;
                    border: 1px solid #ccc;
                  "
                ></div>
                <span style="font-weight: 600">Light Mode</span>
              </div>
            </div>
          </div>
        </section>

        <section
          id="advanced-section"
          class="settings-content"
          style="display: none"
        >
          <header class="section-header">
            <h1>Advanced Settings</h1>
            <p class="subtitle">System identifiers and account management</p>
          </header>
          <div class="channel-info-card">
            <h4>Researcher ID</h4>
            <p id="raw-user-id">---</p>
            <div
              class="settings-section danger-zone-card"
              style="padding: 20px; border-radius: 8px; margin-top: 30px"
            >
              <h4 style="color: var(--error)">Danger Zone</h4>
              <p style="font-size: 0.9rem; margin-bottom: 20px">
                Deleting your account will purge your private drafts. Published
                papers remain archived for research integrity.
              </p>
              <button
                id="request-deletion-btn"
                style="
                  background: var(--error);
                  color: white;
                  border: none;
                  padding: 12px 24px;
                  border-radius: 6px;
                  font-weight: 700;
                  cursor: pointer;
                "
              >
                Request Data Purge & Deletion
              </button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <div id="footer-hook"></div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="js/notification.js"></script>
    <script src="js/script.js"></script>
    <script src="js/settings.js"></script>
  </body>
</html>
