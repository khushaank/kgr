<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - KGR Archive</title>
    <link rel="icon" type="image/png" href="images/KGR.png" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/admin.css" />
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <!-- Mobile Header -->
    <div class="admin-mobile-header">
      <div class="admin-mobile-logo">
        <img src="images/KGR.png" alt="KGR" />
        <span>Admin</span>
      </div>
      <button class="admin-menu-toggle" id="admin-menu-toggle">
        <span class="material-icons">menu</span>
      </button>
    </div>

    <!-- Sidebar Overlay -->
    <div class="admin-sidebar-overlay" id="admin-sidebar-overlay"></div>

    <div class="admin-layout">
      <!-- Sidebar -->
      <aside class="admin-sidebar" id="admin-sidebar">
        <div class="admin-logo">
          <img src="images/KGR.png" alt="KGR" />
          <span class="sidebar-text">Admin Panel</span>
          <button class="sidebar-collapse-btn" id="sidebar-collapse-btn">
            <span class="material-icons">chevron_left</span>
          </button>
        </div>

        <nav class="admin-nav">
          <div class="admin-nav-item active" onclick="showSection('dashboard')">
            <span class="material-icons">dashboard</span>
            <span class="nav-text">Dashboard</span>
          </div>
          <div class="admin-nav-item" onclick="showSection('users')">
            <span class="material-icons">people</span>
            <span class="nav-text">Users</span>
          </div>
          <div class="admin-nav-item" onclick="showSection('articles')">
            <span class="material-icons">article</span>
            <span class="nav-text">Articles</span>
          </div>
          <div class="admin-nav-item" onclick="showSection('analytics')">
            <span class="material-icons">analytics</span>
            <span class="nav-text">Analytics</span>
          </div>
          <div class="admin-nav-item" onclick="showSection('activity')">
            <span class="material-icons">timeline</span>
            <span class="nav-text">Activity</span>
          </div>
          <div class="admin-nav-item" onclick="showSection('notifications')">
            <span class="material-icons">notifications</span>
            <span class="nav-text">Notifications</span>
          </div>
          <div class="admin-nav-item" onclick="showSection('settings')">
            <span class="material-icons">settings</span>
            <span class="nav-text">Settings</span>
          </div>
        </nav>

        <div class="admin-sidebar-footer">
          <a href="index.html" class="admin-back-link">
            <span class="material-icons">arrow_back</span>
            <span class="nav-text">Back to Site</span>
          </a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="admin-main">
        <!-- Dashboard Section -->
        <section id="dashboard-section" class="admin-content-section active">
          <div class="admin-header">
            <h1>Dashboard Overview</h1>
            <div class="admin-header-actions">
              <button class="action-btn" onclick="refreshData()">
                <span class="material-icons">refresh</span>
                <span>Refresh</span>
              </button>
            </div>
          </div>

          <div id="admin-alert-container"></div>

          <!-- Stats Row -->
          <div class="stats-grid">
            <div class="stat-card users">
              <div class="stat-icon">
                <span class="material-icons">people</span>
              </div>
              <div class="stat-value" id="total-users">--</div>
              <div class="stat-label">Registered Users</div>
            </div>
            <div class="stat-card articles">
              <div class="stat-icon">
                <span class="material-icons">article</span>
              </div>
              <div class="stat-value" id="total-articles">--</div>
              <div class="stat-label">Total Articles</div>
            </div>
            <div class="stat-card views">
              <div class="stat-icon">
                <span class="material-icons">visibility</span>
              </div>
              <div class="stat-value" id="total-views">--</div>
              <div class="stat-label">Total Views</div>
            </div>
            <div class="stat-card active">
              <div class="stat-icon">
                <span class="material-icons">trending_up</span>
              </div>
              <div class="stat-value" id="published-count">--</div>
              <div class="stat-label">Published</div>
            </div>
          </div>

          <!-- Charts Grid - 2x2 Layout -->
          <div class="dashboard-charts-grid">
            <!-- Row 1 -->
            <div class="admin-section chart-card">
              <div class="chart-header">
                <span class="material-icons">pie_chart</span>
                <span>Content Status</span>
              </div>
              <div class="chart-body">
                <canvas id="contentChart"></canvas>
              </div>
            </div>

            <div class="admin-section chart-card">
              <div class="chart-header">
                <span class="material-icons">person</span>
                <span>User Engagement</span>
              </div>
              <div class="chart-body">
                <canvas id="engagementChart"></canvas>
              </div>
            </div>

            <!-- Row 2 -->
            <div class="admin-section chart-card">
              <div class="chart-header">
                <span class="material-icons">leaderboard</span>
                <span>Top Authors</span>
              </div>
              <div class="chart-body">
                <canvas id="authorsChart"></canvas>
              </div>
            </div>

            <div class="admin-section chart-card">
              <div class="chart-header">
                <span class="material-icons">visibility</span>
                <span>Top Articles by Views</span>
              </div>
              <div class="chart-body">
                <canvas id="viewsChart"></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- Users Section -->
        <section id="users-section" class="admin-content-section">
          <div class="admin-header">
            <h1>User Management</h1>
            <div class="admin-header-actions">
              <button class="action-btn" onclick="exportUsers()">
                <span class="material-icons">download</span>
                <span>Export</span>
              </button>
            </div>
          </div>

          <div class="admin-filters">
            <div class="admin-search">
              <span class="material-icons">search</span>
              <input
                type="text"
                id="user-search"
                placeholder="Search users by name or email..."
                oninput="filterUsers()"
              />
            </div>
            <select
              class="filter-select"
              id="user-filter"
              onchange="filterUsers()"
            >
              <option value="all">All Users</option>
              <option value="active">Active</option>
              <option value="banned">Banned</option>
            </select>
          </div>

          <div class="admin-section">
            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Joined</th>
                    <th>Articles</th>
                    <th>Views</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="users-table-body">
                  <tr>
                    <td colspan="6" class="empty-state">Loading users...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Articles Section -->
        <section id="articles-section" class="admin-content-section">
          <div class="admin-header">
            <h1>Article Management</h1>
          </div>

          <div class="admin-filters">
            <div class="admin-search">
              <span class="material-icons">search</span>
              <input
                type="text"
                id="article-search"
                placeholder="Search articles..."
                oninput="filterArticles()"
              />
            </div>
            <select
              class="filter-select"
              id="article-status-filter"
              onchange="filterArticles()"
            >
              <option value="all">All Status</option>
              <option value="published">Published</option>
              <option value="draft">Draft</option>
            </select>
          </div>

          <div class="admin-section">
            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Status</th>
                    <th>Views</th>
                    <th>Created</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="articles-table-body">
                  <tr>
                    <td colspan="6" class="empty-state">Loading articles...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Analytics Section -->
        <section id="analytics-section" class="admin-content-section">
          <div class="admin-header">
            <h1>Analytics</h1>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">today</span>
              </div>
              <div class="stat-value" id="today-views">--</div>
              <div class="stat-label">Views Today</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">person_add</span>
              </div>
              <div class="stat-value" id="new-users-week">--</div>
              <div class="stat-label">New Users (7d)</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">edit_note</span>
              </div>
              <div class="stat-value" id="drafts-count">--</div>
              <div class="stat-label">Total Drafts</div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">
                <span class="material-icons">star</span>
              </div>
              <div class="stat-value" id="top-author">--</div>
              <div class="stat-label">Top Author Articles</div>
            </div>
          </div>

          <div class="admin-section">
            <div class="section-header">
              <h2>
                <span class="material-icons">leaderboard</span>
                Top Performing Articles
              </h2>
            </div>
            <div class="admin-table-wrapper">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Views</th>
                  </tr>
                </thead>
                <tbody id="top-articles-body">
                  <tr>
                    <td colspan="4" class="empty-state">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Live Activity Section -->
        <section id="activity-section" class="admin-content-section">
          <div class="admin-header">
            <h1>Activity Feed</h1>
            <div class="admin-header-actions">
              <div class="live-indicator">
                <span class="live-dot"></span>
                <span>Live</span>
              </div>
            </div>
          </div>

          <div class="admin-section">
            <div class="activity-feed" id="live-activity-feed">
              <div class="empty-state">
                <span class="material-icons">hourglass_empty</span>
                <p>Monitoring activity...</p>
              </div>
            </div>
          </div>
        </section>

        <!-- Notifications Section -->
        <section id="notifications-section" class="admin-content-section">
          <div class="admin-header">
            <h1>Notification Center</h1>
          </div>

          <div class="admin-section">
            <div class="section-header">
              <h2>
                <span class="material-icons">send</span> Send Notification
              </h2>
            </div>
            <div class="settings-content">
              <div class="form-group">
                <label>Recipient</label>
                <select
                  id="notif-recipient"
                  class="studio-input"
                  onchange="toggleRecipientField()"
                >
                  <option value="all">All Users (Broadcast)</option>
                  <option value="specific">Specific User</option>
                </select>
              </div>

              <div
                class="form-group"
                id="recipient-id-group"
                style="display: none; position: relative"
              >
                <label>Search User</label>
                <input
                  type="text"
                  id="user-search-input"
                  class="studio-input"
                  placeholder="Search by name, email, or UUID..."
                  autocomplete="off"
                />
                <input type="hidden" id="notif-user-id" />
                <div
                  id="user-search-results"
                  class="search-results-dropdown"
                ></div>
              </div>

              <div class="form-group">
                <label>Type</label>
                <select id="notif-type" class="studio-input">
                  <option value="info">Info (Default)</option>
                  <option value="success">Success (Green)</option>
                  <option value="warning">Warning (Yellow)</option>
                  <option value="error">Error (Red)</option>
                </select>
              </div>

              <div class="form-group">
                <label>Message</label>
                <textarea
                  id="notif-message"
                  class="studio-input"
                  rows="3"
                  placeholder="Enter your message here..."
                ></textarea>
              </div>

              <div class="form-group">
                <label>Link (Optional)</label>
                <input
                  type="text"
                  id="notif-link"
                  class="studio-input"
                  placeholder="https://..."
                />
              </div>

              <button class="primary-btn" onclick="sendAdminNotification()">
                <span class="material-icons">send</span> Send Notification
              </button>
            </div>
          </div>
        </section>

        <!-- Settings Section -->
        <section id="settings-section" class="admin-content-section">
          <div class="admin-header">
            <h1>Admin Settings</h1>
          </div>

          <!-- Quick Actions -->
          <div class="admin-section">
            <div class="section-header">
              <h2>
                <span class="material-icons">flash_on</span>
                Quick Actions
              </h2>
            </div>
            <div class="settings-grid">
              <button class="settings-action-card" onclick="clearLocalData()">
                <span class="material-icons">delete_sweep</span>
                <strong>Clear Cache</strong>
                <p>Clear local browser cache and refresh data</p>
              </button>
              <button class="settings-action-card" onclick="exportAllData()">
                <span class="material-icons">cloud_download</span>
                <strong>Export Data</strong>
                <p>Download all users and articles as JSON</p>
              </button>
              <button
                class="settings-action-card danger"
                onclick="signOutAdmin()"
              >
                <span class="material-icons">logout</span>
                <strong>Sign Out</strong>
                <p>Log out of the admin panel</p>
              </button>
            </div>
          </div>

          <!-- System Info -->
          <div class="admin-section">
            <div class="section-header">
              <h2>
                <span class="material-icons">info</span>
                System Information
              </h2>
            </div>
            <div class="settings-content">
              <div class="info-grid">
                <div class="info-item">
                  <span class="info-label">Version</span>
                  <span class="info-value">1.0.0</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Last Refresh</span>
                  <span class="info-value" id="last-refresh">--</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Logged in as</span>
                  <span class="info-value" id="admin-email">--</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Database</span>
                  <span class="info-value">Supabase</span>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- User Detail Modal -->
    <div class="admin-modal" id="user-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>
            <span class="material-icons">person</span>
            User Details
          </h2>
          <button class="modal-close" onclick="closeUserModal()">
            <span class="material-icons">close</span>
          </button>
        </div>
        <div class="modal-body" id="user-modal-body">
          <!-- Populated by JS -->
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="js/notification.js"></script>
    <script src="js/admin.js"></script>
  </body>
</html>
